---
# Copyright (c) 2024 HashiCorp, Inc.
# Terraform and the Terraform logo are trademarks of HashiCorp.
#
# Documentation licensed under the Business Source License, Version 1.1.
# The original work was translated from English into Brazilian Portuguese.
# https://github.com/hashicorp/terraform/blob/-/LICENSE

source_url: https://github.com/hashicorp/web-unified-docs/blob/main/content/terraform/v1.14.x/docs/intro/core-workflow.mdx
revision: 110cc70f5ac401444bfe089dd5caa2f39038e2d7
status: ready

page_title: Visão geral do fluxo de trabalho principal do Terraform
description: >-
  Aprenda como provisionar e gerenciar infraestrutura usando o fluxo de trabalho
  principal do Terraform individualmente e em times e organizações.
---

# Visão geral do fluxo de trabalho principal do Terraform

O fluxo de trabalho principal do Terraform tem três etapas:

1. **Escrita** - Crie infraestrutura como código.
2. **Planejamento** - Visualize as alterações antes de aplicá-las.
3. **Execução** - Provisione infraestrutura reproduzível.

Este guia explica como cada uma dessas três etapas funciona no contexto do
trabalho individual, como elas evoluem quando um time colabora na infraestrutura
e como o HCP Terraform permite que esse fluxo de trabalho seja executado sem
problemas para organizações inteiras.

## Trabalhando como profissional independente

Vamos primeiro analisar como essas partes se encaixam quando você trabalha
individualmente com infraestrutura como código.

### Escrita

Você escreve a configuração do Terraform da mesma forma que escreve código: no
seu editor de texto preferido.
É uma prática comum armazenar seu trabalho em um repositório com controle de
versão, mesmo quando você trabalha individualmente.

```sh
# Crie o repositório
$ git init my-infra && cd my-infra

Initialized empty Git repository in /.../my-infra/.git/

# Escreva a configuração inicial
$ vim main.tf

# Inicialize o Terraform
$ terraform init

Initializing provider plugins...
# ...
Terraform has been successfully initialized!
```

À medida que você avança na criação da sua configuração, executar planos
repetidamente pode ajudar a eliminar erros de sintaxe e garantir que sua
configuração esteja sendo elaborada conforme o esperado.

```sh
# Faça alterações na configuração
$ vim main.tf

# Revise o plano
$ terraform plan

# Faça edições adicionais e repita
$ vim main.tf
```

Isso se assemelha ao trabalho individual no código de uma aplicação, onde um
ciclo de feedback curto entre a edição do código e a execução de comandos de
teste é útil.

### Planejamento

Quando o ciclo de feedback da etapa de escrita resultar em uma alteração
satisfatória, é hora de fazer o commit do seu trabalho e revisar o plano final.

```sh
$ git add main.tf
$ git commit -m 'Gerenciando infraestrutura como código!'

[main (root-commit) f735520] Gerenciando infraestrutura como código!
 1 file changed, 1 insertion(+)
```

Como o comando `terraform apply` exibirá um plano para confirmação antes de
prosseguir com qualquer alteração na infraestrutura, esse é o comando que você
executa para a revisão final.

```sh
$ terraform apply

An execution plan has been generated and is shown below.
# ...
```

### Execução

Após uma última verificação, você está pronta para instruir o Terraform a
provisionar a infraestrutura real.

```sh
Do you want to perform these actions?

  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.
  Enter a value: yes

# ...

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
```

Neste ponto, é comum fazer o push do seu repositório de controle de versão para
um local remoto para mantê-lo em segurança.

```sh
$ git remote add origin https://github.com/*user*/*repo*.git
$ git push origin main
```

Este fluxo de trabalho principal é um ciclo; da próxima vez que você quiser
fazer alterações, você inicia o processo novamente desde o início.

Percebe como esse fluxo de trabalho se assemelha ao processo de escrever código
ou scripts de aplicações individualmente?
É isso que queremos dizer quando falamos sobre o Terraform habilitando
infraestrutura como código.

## Trabalhando em equipe

Quando várias pessoas estão colaborando na configuração do Terraform, novas
etapas devem ser adicionadas a cada parte do fluxo de trabalho principal para
garantir que todas estejam trabalhando juntas sem problemas.
Você verá que muitas dessas etapas são paralelas às mudanças de fluxo de
trabalho que fazemos quando trabalhamos no código da aplicação em equipe, em vez
de individualmente.

### Escrita

Embora cada pessoa do time ainda faça alterações na configuração do Terraform em
seu editor de preferência, elas salvam suas alterações em _branches_ de controle
de versão para evitar conflitos com o trabalho umas das outras.
Trabalhar em branches permite que as pessoas do time resolvam alterações de
infraestrutura mutuamente incompatíveis usando seu fluxo de trabalho normal de
resolução de conflitos de merge.

```sh
$ git checkout -b add-load-balancer

Switched to a new branch 'add-load-balancer'
```

Executar planos iterativos ainda é útil como um ciclo de feedback durante a
criação de configurações, embora ter o computador de cada pessoa do time capaz
de executá-los torne-se mais difícil com o tempo.
À medida que o time e a infraestrutura crescem, também aumenta o número de
variáveis de entrada sensíveis (por exemplo, chaves de API, pares de
certificados SSL) necessárias para executar um plano.

Para evitar o ônus e o risco de segurança de cada pessoa do time organizar todas
as entradas sensíveis localmente, é comum que os times migrem para um modelo no
qual as operações do Terraform são executadas em um ambiente de integração
contínua (CI) compartilhado.
O trabalho necessário para criar um ambiente de CI desse tipo não é trivial e
está fora do escopo desta visão geral do fluxo de trabalho principal, mas um
estudo sobre este tópico pode ser encontrado em nosso guia
[Executando o Terraform em automação](/terraform/tutorials/automation/automate-terraform?utm_source=WEBSITE&utm_medium=WEB_IO&utm_offer=ARTICLE_PAGE&utm_content=DOCS).

Este ciclo de iteração mais longo de confirmar alterações no controle de versão
e, em seguida, esperar que a esteira de CI seja executada, geralmente é longo o
suficiente para impedir o uso de planos especulativos como um ciclo de feedback
durante a criação de alterações de configuração individuais do Terraform.
Os planos especulativos ainda são úteis antes que novas alterações do Terraform
sejam aplicadas ou mesmo que seja feito o merge com o branch principal de
desenvolvimento, como veremos em breve.

### Planejamento

Para times que colaboram em infraestrutura, a saída do plano do Terraform cria
uma oportunidade para que as pessoas do time revisem o trabalho umas das outras.
Isso permite que o time faça perguntas, avalie riscos e identifique erros antes
que quaisquer alterações potencialmente prejudiciais sejam feitas.

O local natural para essas revisões ocorrerem é junto aos pull requests dentro
do controle de versão — o ponto em que uma pessoa propõe um merge de seu branch
de trabalho para o branch compartilhado do time.
Se as pessoas do time revisarem as alterações de configuração propostas com a
saída do plano especulativo, elas podem avaliar se a intenção da alteração está
sendo alcançada pelo plano.

O problema se torna produzir essa saída do plano especulativo para o time
revisar.
Alguns times que ainda executam localmente o Terraform adotam a prática de que
os pull requests devem incluir uma cópia anexada da saída do plano especulativo
gerada pela pessoa autora da alteração.
Outros configuram seu sistema de CI para publicar a saída do plano especulativo
nos pull requests automaticamente.

![Captura de tela do pull request com saída do plano Terraform postada manualmente](/img/docs/manually-pasted-plan-output.png)

Além de revisar o plano para verificar se ele expressa adequadamente a intenção
da pessoa autora, o time também pode avaliar se deseja que essa alteração seja
implementada imediatamente.
Por exemplo, se um time perceber que uma determinada alteração pode resultar em
interrupção do serviço, ela pode decidir adiar o merge do pull request até que
possa agendar uma janela de manutenção.

### Execução

Após um pull request ter sido aprovado e o merge ter sido feito, é importante
que o time revise o plano concreto final executado no branch compartilhado do
time e a versão mais recente do arquivo de estado.

Este plano pode ser diferente daquele revisado no pull request devido a
problemas como a ordem de merge ou alterações recentes na infraestrutura.
Por exemplo, se uma alteração manual foi feita na sua infraestrutura desde a
revisão do plano, o plano pode ser diferente após o merge.

É neste ponto que o time questiona as possíveis implicações da aplicação da
alteração.
Esperamos alguma interrupção de serviço devido a esta alteração?
Existe alguma parte desta alteração que seja de alto risco?
Há algo em nosso sistema que devemos monitorar durante a aplicação?
Há alguém que precisamos notificar sobre a ocorrência desta alteração?

Dependendo da alteração, algumas pessoas do time podem querer acompanhar a saída
da aplicação em tempo real.
Para times que executam o Terraform localmente, isso pode envolver o
compartilhamento de tela com o time.
Para times que executam o Terraform em CI, isso pode envolver a análise do log
de construção.

Assim como o fluxo de trabalho individual, o fluxo de trabalho principal para
times é um ciclo que se repete a cada alteração.
Para alguns times, esse ciclo ocorre algumas vezes por semana, para outros,
várias vezes ao dia.

## O fluxo de trabalho principal aprimorado pelo HCP Terraform

Embora os fluxos de trabalho descritos acima permitam a criação ou alteração
segura, previsível e reproduzível de infraestrutura, existem vários pontos de
colaboração que podem ser simplificados, especialmente à medida que times e
organizações crescem.
Projetamos o HCP Terraform para oferecer suporte e aprimorar o fluxo de trabalho
principal do Terraform para qualquer pessoa que colabore em infraestrutura,
desde pequenos times até grandes organizações.
Vamos ver como o HCP Terraform proporciona uma experiência melhor em cada etapa.

### Escrita

O HCP Terraform fornece um local centralizado e seguro para armazenar variáveis
de entrada e estado, além de oferecer um ciclo de feedback eficiente para planos
especulativos para pessoas autoras de configuração.
A configuração do Terraform pode interagir com o HCP Terraform por meio da
[integração com a CLI](/terraform/cli/cloud).

```hcl
terraform {
  cloud {
    organization = "my-org"
    hostname = "app.terraform.io" # Opcional; o padrão é app.terraform.io

    workspaces {
      tags = {
        layer = "networking"
        source = "cli"
      }

      # Para versões do Terraform anteriores à 1.10, você deve especificar tags
      # somente com chaves usando uma lista de strings. Exemplo:
      # tags = ["networking", "source:cli"]
    }
  }
}
```

Após configurar a integração, uma chave de API do Terraform do HCP é tudo o que
as pessoas do seu time precisam para editar a configuração e executar planos
especulativos contra a versão mais recente do arquivo de estado usando todas as
variáveis de entrada armazenadas remotamente.

```sh
$ terraform workspace select my-app-dev
Switched to workspace "my-app-dev".

$ terraform plan

Running plan remotely in Terraform Enterprise.

Output will stream here. To view this plan in a browser, visit:

https://app.terraform.io/my-org/my-app-dev/.../

Refreshing Terraform state in-memory prior to plan...

# ...

Plan: 1 to add, 0 to change, 0 to destroy.
```

Com a ajuda deste plano de execução, as pessoas do time podem trabalhar na
criação da configuração até que ela esteja pronta para ser proposta como uma
alteração por meio de um de pull request.

### Planejamento

Assim que um pull request estiver pronto para revisão, o HCP Terraform facilita
o processo de revisão de um plano especulativo para as pessaos do time.
Primeiro, o plano é executado automaticamente quando o pull request é criado.
As atualizações de status do pull request indicam o andamento do plano.

Assim que o plano for concluído, a atualização de status indica se houve alguma
alteração no plano especulativo, diretamente na visualização do pull request.

![Captura de tela de um pull request com alterações de recursos na atualização de status](/img/docs/pull-request.png)

Para certos tipos de alterações, essas informações são tudo o que uma pessoa do
time precisa para aprovar o pull request.
Quando uma pessoa do time precisa fazer uma revisão completa do plano, clicar no
link para o HCP Terraform abre uma visualização que permite analisar rapidamente
os detalhes completos do plano.

![Captura de tela da execução do pull request no HCP Terraform](/img/docs/pr-plan.png)

Esta página permite que a pessoa revisora determine rapidamente se o plano
corresponde à intenção da pessoa autora da configuração e avalie o risco da
alteração.

### Execução

Após o merge, o HCP Terraform apresenta o plano concreto ao time para revisão e
aprovação.

![Captura de tela do plano concreto](/img/docs/concrete-plan.png)

O time pode discutir quaisquer dúvidas pendentes sobre o plano antes da
alteração ser feita.

![Captura de tela da troca de informações nos comentários do HCP Terraform](/img/docs/plan-comments.png)

Assim que a execução for confirmada, o HCP Terraform exibirá o progresso ao vivo
para qualquer pessoa que queira acompanhar.

![Captura de tela da execução em andamento](/img/docs/in-progress-apply.png)

<!--

TODO: Add this back in w/ screenshot of notification

And after the change completes, the team can be notified of its outcome.

    [ Multi-screenshot of Slack alert indicating Apply completed successfully and
    with error; except it's not gonna be Slack anymore? ]

-->

## Conclusão

Existem muitas maneiras de usar o Terraform: individualmente, em um único time
ou em uma organização inteira em grande escala.
Escolher a melhor abordagem para a densidade de colaboração necessária
proporcionará o maior retorno sobre o investimento no fluxo de trabalho
principal do Terraform.
Para organizações que usam o Terraform em grande escala, o HCP Terraform
introduz novas camadas que se baseiam nesse fluxo de trabalho principal para
resolver problemas exclusivos de times e organizações.
